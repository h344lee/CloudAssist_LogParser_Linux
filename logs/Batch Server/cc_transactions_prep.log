1                                                          The SAS System                           05:37 Monday, September 14, 2020

NOTE: Copyright (c) 2016 by SAS Institute Inc., Cary, NC, USA. 
NOTE: SAS (r) Proprietary Software 9.4 (TS1M6) 
      Licensed to 19W30_FASHBI, Site 70068130.
NOTE: This session is executing on the X64_DSRV16  platform.



NOTE: Analytical products:
      
      SAS/STAT 15.1
      SAS/ETS 15.1
      SAS/OR 15.1
      SAS/QC 15.1

NOTE: Additional host information:

 X64_DSRV16 WIN 10.0.14393  Server

NOTE: SAS initialization used:
      real time           0.08 seconds
      cpu time            0.09 seconds
      
NOTE: Libref SASDATA successfully assigned from logical server.
NOTE: Libref WRSDIST successfully assigned from logical server.
NOTE: Libref WRSTEMP successfully assigned from logical server.
NOTE: Libref VALIB successfully assigned from logical server.
NOTE: Libref PMMODEL successfully assigned from logical server.
NOTE: Libref STPSAMP successfully assigned from logical server.

NOTE: AUTOEXEC processing beginning; file is D:\SAS\Config\Lev1\SASApp\BatchServer\autoexec.sas.


NOTE: AUTOEXEC processing completed.

1          
2          /*------------------------------------------------
3           *        Cleanup mst_prep views
4           *------------------------------------------------*/
5           proc datasets lib=mst_prep nolist nowarn;
ERROR: Libref MST_PREP is not assigned.
6           delete cc_party_transactions;
7           quit;

NOTE: Statements not processed because of errors noted above.
NOTE: The SAS System stopped processing this step because of errors.
NOTE: Due to ERROR(s) above, SAS set option OBS=0, enabling syntax check mode. 
      This prevents execution of subsequent data modification statements.
NOTE: PROCEDURE DATASETS used (Total process time):
      real time           0.02 seconds
      cpu time            0.01 seconds
      
8          
9           /*------------------------------------------------------
10           * Find earliest day in job calendar
11           * This will be used to see to check if enough history
12           * in the job calendar to create the views
13           *------------------------------------------------------*/
14         
2                                                          The SAS System                           05:37 Monday, September 14, 2020



15           proc sql noprint;
NOTE: PROC SQL set option NOEXEC and will continue to check the syntax of statements.
16              select put(datepart(min(calendar_date)),best.) into :first_job_calendar_date
17              from seg_kc.fsk_job_calendar;
ERROR: Libref SEG_KC is not assigned.
18           quit;
NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      
WARNING: Apparent symbolic reference RUNASOFDATE not resolved.
19         /*  %let runasofdate=20160210;*/
20           %put runasofdate=&runasofdate;
runasofdate=&runasofdate
21           %put first_job_calendar_date=&first_job_calendar_date;
WARNING: Apparent symbolic reference FIRST_JOB_CALENDAR_DATE not resolved.
first_job_calendar_date=&first_job_calendar_date
22         
23         /* Retrieve daily data set from Core database */


24          proc sql;
NOTE: PROC SQL set option NOEXEC and will continue to check the syntax of statements.
25             connect to &dbflavor as &dbflavor (authdomain="&segkcAuthDomain."
                          _
                          22
                          76
WARNING: Apparent symbolic reference DBFLAVOR not resolved.
WARNING: Apparent symbolic reference DBFLAVOR not resolved.
WARNING: Apparent symbolic reference SEGKCAUTHDOMAIN not resolved.
ERROR 22-322: Expecting a name.  

ERROR 76-322: Syntax error, statement will be ignored.

26                                                &segKCDBConnOpts);
WARNING: Apparent symbolic reference SEGKCDBCONNOPTS not resolved.
27             create table mst_prep.cc_party_trans&runasofdate as
                                                   _
                                                   22
WARNING: Apparent symbolic reference RUNASOFDATE not resolved.
27             create table mst_prep.cc_party_trans&runasofdate as
                                                   _
                                                   200
ERROR 22-322: Syntax error, expecting one of the following: (, AS, LIKE.  

ERROR 200-322: The symbol is not recognized and will be ignored.

28             select
29                account_number length=50,
30                party_number length=50,
31         	   customer_risk_category,
32         	   party_type_desc,
33         	   input("&runasofdate",yymmdd8.) as date_key format=yymmdd8. length=5,
WARNING: Apparent symbolic reference RUNASOFDATE not resolved.
34                transaction_cdi_code length=1,
3                                                          The SAS System                           05:37 Monday, September 14, 2020

35                primary_medium_desc length=20,
36                secondary_medium_desc length=20,
37                mechanism_desc length=20,
38                currency_code length=3,
39                currency_amount length=8,
40                transaction_key length=8,
41                risk_classification length=3,
42                int(yrdif(datepart(party_date_of_birth),today(),'AGE')) as party_age ,
43         	   TOTAL_ASSET_WHEN_TO_REG_CC,
44         	   SENDER_BLOCKCHAIN_ADDRESS,
45         	   RECEIVER_BLOCKCHAIN_ADDRESS,
46         	   residence_country_code,
47         	   country_code_3 as country_code,
48         input("&runasofdate",yymmdd8.) - datepart(customer_since_date) as no_of_days_since_active
WARNING: Apparent symbolic reference RUNASOFDATE not resolved.
49         from connection to &dbflavor
WARNING: Apparent symbolic reference DBFLAVOR not resolved.
49         from connection to &dbflavor
                              _
                              22
ERROR 22-322: Expecting a name.  

49         from connection to &dbflavor
                              _
                              76
ERROR 76-322: Syntax error, statement will be ignored.

50               (select
51                       A.account_number,
52                       B.party_number,
53         			  B.party_date_of_birth,
54                       B.risk_classification,
55         			  B.party_type_desc,
56         			  B.customer_risk_category,
57         			  B.TOTAL_ASSET_WHEN_TO_REG_CC,
58         			  B.customer_since_date,
59         			  B.residence_country_code,
60                       C.transaction_cdi_code,
61                       C.primary_medium_desc,
62                       C.secondary_medium_desc,
63                       C.mechanism_desc,
64                       F.currency_code,
65                       I.currency_amount,
66                       I.transaction_key,
67         			  I.SENDER_BLOCKCHAIN_ADDRESS,
68         	   		  I.RECEIVER_BLOCKCHAIN_ADDRESS,
69         			  J.country_code_3
70                       from
71                       &segKCSchema..fsc_account_dim A,
WARNING: Apparent symbolic reference SEGKCSCHEMA not resolved.
72                       &segKCSchema..fsc_party_dim B,
WARNING: Apparent symbolic reference SEGKCSCHEMA not resolved.
73                       &segKCSchema..fsc_transaction_type_dim C,
WARNING: Apparent symbolic reference SEGKCSCHEMA not resolved.
74                       &segKCSchema..fsc_currency_dim F,
WARNING: Apparent symbolic reference SEGKCSCHEMA not resolved.
75                       &segKCSchema..fsc_party_account_bridge H,
WARNING: Apparent symbolic reference SEGKCSCHEMA not resolved.
4                                                          The SAS System                           05:37 Monday, September 14, 2020

76                       &segKCSchema..fsc_cash_flow_fact I,
WARNING: Apparent symbolic reference SEGKCSCHEMA not resolved.
77         			  &segKCSchema..fsc_country_dim J
WARNING: Apparent symbolic reference SEGKCSCHEMA not resolved.
78                       where
79                       I.account_key = A.account_key and
80                       A.account_key = H.account_key and
81                       B.party_key = H.party_key and
82                       I.transaction_type_key = C.transaction_type_key and
83                       I.transaction_currency_key = F.currency_key and
84         			  I.country_key=J.country_key and
85                       I.date_key = &runasofdate and
WARNING: Apparent symbolic reference RUNASOFDATE not resolved.
86                       H.role_key = 1 and
87                       H.change_current_ind = 'Y'
88                   )
89                order by party_number, date_key;
90         
91             disconnect from &dbflavor;
                               _
                               22
                               200
WARNING: Apparent symbolic reference DBFLAVOR not resolved.
ERROR 22-322: Expecting a name.  

ERROR 200-322: The symbol is not recognized and will be ignored.

92          quit;
NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
      
93         
94         /*----------------------------------
95          * Create CC_PARTY_TRANSACTIONS view
96          *----------------------------------*/
97          %macro fcf_create_pty_trans_view;
98         
99            /* Determine number of days to chain daily prep files together.*/
100             proc sql noprint;
101                select max(input(sp.parm_value,best32.)) into :numdays
102                  from seg_kc.fsk_header h,
103                       seg_kc.fsk_scenario s,
104                       seg_kc.fsk_scenario_parameter sp
105                 where h.header_id=s.header_id and
106                       upcase(h.denorm_table_name) = "CC_PARTY_TRANSACTIONS" and
107                       upcase(s.scenario_status_code) = "ACT" and
108                       upcase(s.current_ind) = "Y" and
109                       upcase(s.logical_delete_ind) ne 'Y' and
110                       s.scenario_id = sp.scenario_id and
111                       sp.parm_name like 'p%_num_days'
112                       ;
113             quit;
114             %let numdays=&numdays;  /*trim blanks*/
115             /*Some scenarios don't have a num_days parameter
116               but still need one day of transactions.*/
117             %if &numdays eq . %then %let numdays = 1;
5                                                          The SAS System                           05:37 Monday, September 14, 2020

118             %put Party numdays: &numdays;
119        
120            /* Check for existence of numdays.  Ensure that it is >= 1      */
121            /* If numdays exists, check the job calendar has enough history */
122        
123             data _null_;
124                if symexist("numdays") then do;
125                   /* find first day of view */
126                   currentday = input(put(&runasofdate,8.),yymmdd8.);
127                   currentday_number = input(put(currentday,date_to_num.),8.);
128                   first_day = input(put(currentday_number - &numdays,num_to_date.),8.);
129        
130                   /* Check data needed for scenario */
131                   if &numdays le 0 then do;
132                      put "LOADNOTE:  Prep file for cc_party_transactions could not be built.";
133                      put "LOADNOTE:  Possible cause: No ACTive PARTY scenarios.";
134                      call symput('active',"NO");
135                   end;
136                   else if first_day < &first_job_calendar_date then do;
137                      put "LOADNOTE:  Prep file for cc)party_transactions could not be built.";
138                       put "WARNING:  Job Calendar does not include enough history.";
139                      call symput('active',"NO");
140                   end;
141                   else call symput('active',"YES");
142                end;
143                else do;
144                   call symput('active',"NO");
145                   put "LOADNOTE:  Prep file for cc_party_transactions could not be built";
146                end;
147             run;
148        
149            %if &active = YES %then %do;
150        
151              /* Build list of daily prep files for merge */
152               data _null_;
153                 currentday = input(put(&runasofdate,8.),yymmdd8.);
154        
155                 do i = 0 to &numdays - 1;
156                   currentday_number = input(put(currentday,date_to_num.),8.);
157                   if currentday_number eq -1 then do;    /*non-business day*/
158                     currentday_prev = currentday;
159                     do until (currentday_number ne -1);
160                       currentday_prev = currentday_prev - 1;
161                       currentday_number = input(put(currentday_prev,date_to_num.),8.);
162                     end;
163                   end;
164        
165                   current_business_day = input(put(currentday_number, num_to_date.),8.);
166                   call
166      ! symput('daydate'||left(trim(put(i,best32.))),'mst_prep.cc_party_trans'||put(current_business_day,yymmddn8.));
167        
168                   currentday = current_business_day - 1;
169                 end;
170                run;
171        
172               %let no_ds_count = 0;
173               %do i = 0 %to (&numdays - 1);
174                  %if not %sysfunc(exist(&&daydate&i)) %then %do;
6                                                          The SAS System                           05:37 Monday, September 14, 2020

175                    %put WARNING: Cannot find party daily transaction data set &&daydate&i;
176                    %let no_ds_count = %eval(&no_ds_count+1);
177                  %end;
178               %end;
179               %if &no_ds_count = &numdays %then %do;
180                 %put ERROR: Cannot find any of the party daily transaction data sets.;
181                 %abort cancel 4;
182               %end;
183        
184              /* Build and execute merge code that creates view across each daily
185                 trans file */
186               data mst_prep.cc_party_transactions
187        										/view=mst_prep.cc_party_transactions;
188                  merge
189                  %do i = 0 %to (&numdays - 1);
190                     %if %sysfunc(exist(&&daydate&i)) %then &&daydate&i;
191                  %end;
192                  ;
193                  by party_number date_key;
194               run;
195            %end; /* End active = YES */
196         %mend fcf_create_pty_trans_view;
197         %fcf_create_pty_trans_view;


NOTE: PROC SQL set option NOEXEC and will continue to check the syntax of statements.
ERROR: Libref SEG_KC is not assigned.
ERROR: Libref SEG_KC is not assigned.
ERROR: Libref SEG_KC is not assigned.
NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      
WARNING: Apparent symbolic reference NUMDAYS not resolved.
ERROR: The text expression &NUMDAYS contains a recursive reference to the macro variable NUMDAYS.  The macro variable will be 
       assigned the null value.
Party numdays:


NOTE: Line generated by the invoked macro "FCF_CREATE_PTY_TRANS_VIEW".
197                          data _null_;         if symexist("numdays") then do;                        currentday =
197      ! input(put(&runasofdate,8.),yymmdd8.);            currentday_number = input(put(currentday,date_to_num.),8.);
                     _
                     22
197      ! first_day = input(put
WARNING: Apparent symbolic reference RUNASOFDATE not resolved.
NOTE 137-205: Line generated by the invoked macro "FCF_CREATE_PTY_TRANS_VIEW".
197                          data _null_;         if symexist("numdays") then do;                        currentday =
197      ! input(put(&runasofdate,8.),yymmdd8.);            currentday_number = input(put(currentday,date_to_num.),8.);
                                                                                                     ____________
                                                                                                     48
197      ! first_day = input(put
ERROR 22-322: Syntax error, expecting one of the following: a name, a quoted string, a numeric constant, a datetime constant, 
              a missing value, INPUT, PUT.  

ERROR 48-59: The format DATE_TO_NUM was not found or could not be loaded.

7                                                          The SAS System                           05:37 Monday, September 14, 2020

NOTE: Line generated by the invoked macro "FCF_CREATE_PTY_TRANS_VIEW".
197        (currentday_number - &numdays,num_to_date.),8.);                          if &numdays le 0 then do;               put
                                        _                                                           _
                                        22                                                          388
                                                                                                    200
                                         ____________
                                         48
197      ! "LOADNOTE:  Prep file for cc_party_transactions could not be built.";               put
ERROR 22-322: Syntax error, expecting one of the following: a name, a quoted string, a numeric constant, a datetime constant, 
              a missing value, INPUT, PUT.  

ERROR 388-185: Expecting an arithmetic operator.

ERROR 200-322: The symbol is not recognized and will be ignored.

ERROR 48-59: The format NUM_TO_DATE was not found or could not be loaded.

NOTE: Line generated by the invoked macro "FCF_CREATE_PTY_TRANS_VIEW".
197         "LOADNOTE:  Possible cause: No ACTive PARTY scenarios.";               call symput('active',"NO");            end;
197      !       else if first_day < &first_job_calendar_date then do;               put
                                     _
                                     22
WARNING: Apparent symbolic reference FIRST_JOB_CALENDAR_DATE not resolved.
NOTE: Line generated by the invoked macro "FCF_CREATE_PTY_TRANS_VIEW".
197         "LOADNOTE:  Possible cause: No ACTive PARTY scenarios.";               call symput('active',"NO");            end;
197      !       else if first_day < &first_job_calendar_date then do;               put
                                                                   __
                                                                   180
ERROR 22-322: Syntax error, expecting one of the following: a name, a quoted string, a numeric constant, a datetime constant, 
              a missing value, bitstring, INPUT, PUT.  

ERROR 180-322: Statement is not valid or it is used out of proper order.

NOTE: Line generated by the invoked macro "FCF_CREATE_PTY_TRANS_VIEW".
197         "LOADNOTE:  Prep file for cc)party_transactions could not be built.";                put "WARNING:  Job Calendar does
197      ! not include enough history.";               call symput('active',"NO");            end;            else call
                                                                                              ___             ____
                                                                                              161             160
197      ! symput('active',"YES");
NOTE: Line generated by the invoked macro "FCF_CREATE_PTY_TRANS_VIEW".
197                 end;         else do;            call symput('active',"NO");            put "LOADNOTE:  Prep file for
                    ___          ____
                    161          160
197      ! cc_party_transactions could not be built";         end;      run;

ERROR 161-185: No matching DO/SELECT statement.

ERROR 160-185: No matching IF-THEN clause.

NOTE: The SAS System stopped processing this step because of errors.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      


WARNING: Apparent symbolic reference ACTIVE not resolved.
ERROR: A character operand was found in the %EVAL function or %IF condition where a numeric operand is required. The condition was: 
8                                                          The SAS System                           05:37 Monday, September 14, 2020

       &active = YES 
ERROR: The macro FCF_CREATE_PTY_TRANS_VIEW will stop executing.
198        

ERROR: Errors printed on pages 1,2,3,4,6,7,8.

NOTE: SAS Institute Inc., SAS Campus Drive, Cary, NC USA 27513-2414
NOTE: The SAS System used:
      real time           0.23 seconds
      cpu time            0.21 seconds
      
